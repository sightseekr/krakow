<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ultimate Map: Krakow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
  <style>
     @import url('https://fonts.googleapis.com/css2?family=Avenir:wght@300;400&family=Brandon+Grotesque:wght@400;700&display=swap');

/* Login page styles */
#login-page {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(180deg, #FFFEFC, #FADBD8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.login-container {
  text-align: center;
  background: #FFFEFC;
  padding: 30px;
  border-radius: 24px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
  max-width: 420px;
  width: 90%;
}

.login-logo {
  width: 100%;
  max-width: 370px;
  height: auto;
  margin-bottom: 0px;
}

.login-container h2 {
  font-family: 'Brandon Grotesque', sans-serif;
  font-size: 1.8em;
  margin-bottom: 10px;
  color: #444454;
}

.login-subtitle {
  font-size: 1em;
  color: #666;
  margin-bottom: 24px;
}

#password {
  width: 100%;
  padding: 14px 18px;
  box-sizing: border-box;
  margin-bottom: 16px;
  border-radius: 12px;
  border: 1px solid #F5B9B4;
  background-color: #FFFEFC;
  font-size: 1em;
  outline: none;
  transition: border-color 0.3s ease;
}

#password:focus {
  border-color: #EA736B;
}

#login-btn {
  background-color: #EA736B;
  color: white;
  padding: 14px 28px;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  font-family: 'Avenir', sans-serif;
  font-weight: bold;
  font-size: 1em;
  transition: all 0.3s ease;
  width: 100%;
}

#login-btn:hover {
  background-color: #EF968F;
  transform: scale(1.03);
}

#error {
  color: #EA736B;
  font-style: italic;
  margin-top: 10px;
  display: none;
}
    body { margin: 0; padding: 0; font-family: sans-serif; }
    #map-container { display: none; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    .mapboxgl-popup-content {
      background-color: rgba(255, 255, 255, 1) !important;
      border-radius: 6px;
      padding: 8px 12px;
      font-family: sans-serif;
      max-width: 220px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.2);
    }
    .custom-popup strong {
      font-weight: bold;
      display: block;
      margin-bottom: 4px;
    }
    .custom-popup p {
      font-size: 0.85em;
      font-style: italic;
      margin: 0 0 6px;
    }
    .custom-popup .directions-btn,
    .custom-popup .mark-visited-btn {
      all: unset;
      background-color: #540000;
      color: white;
      padding: 6px 10px;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      font-size: 0.85em;
      display: inline-flex;
      align-items: center;
      min-height: 25px;
      max-height: 26px;
      gap: 5px;
      text-decoration: none;
    }
    .custom-popup .directions-btn:hover {
      background-color: #330101;
    }
    #search-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      width: 90%;
      max-width: 400px;
    }
    #search {
      width: 100%;
      padding: 8px 12px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #suggestions {
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      max-height: 200px;
      overflow-y: auto;
      position: absolute;
      width: 100%;
      z-index: 2;
    }
    .suggestion {
      padding: 8px 12px;
      cursor: pointer;
    }
    .suggestion:hover {
      background: #f0f0f0;
    }
    .no-results {
      padding: 8px 12px;
      color: #666;
      font-style: italic;
    }
    #layer-toggle {
  position: absolute;
  bottom: 10px;
  left: 10px;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 10px 12px;
  font-size: 0.9em;
  z-index: 2;
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

#layer-toggle h3 {
  margin: 0 0 8px;
  font-size: 1em;
}
#layer-toggle label {
  display: block;
  cursor: pointer;
}
#layer-toggle label {
  display: flex;
  align-items: center;
  margin-bottom: 4px;
  gap: 6px;
}

#layer-toggle .legend-icon {
  width: 18px;
  height: 18px;
  object-fit: contain;
}
.icon {
  display: inline-block;
  background-image: url('https://api.mapbox.com/styles/v1/sightseekr/cmja2st1i004k01qp0afrewy1/sprite.png?access_token=pk.eyJ1Ijoic2lnaHRzZWVrciIsImEiOiJjbWgxdmNsZ2owc3h2MDhxcGdiZno4c3ptIn0.ODNk5NVKUxNh0b9QoL5tqQ');
  background-repeat: no-repeat;
  margin-right: 6px;
  vertical-align: middle;
}

/* Example numbers ‚Äî update from your JSON */
.icon-cafe {
  background-position: -92px -286px;
  width: 20px;
  height: 20px;
}

.icon-restaurant {
  background-position: -40px -386px;
  width: 20px;
  height: 20px;
}

.icon-bar {
  background-position: -264px -266px;
  width: 20px;
  height: 20px;
}

.icon-attraction {
  background-position: -328px -245px;
  width: 20px;
  height: 20px;
}
  </style>
</head>
<body>
    <!-- Login Page -->
<div id="login-page">
  <div class="login-container">
    <img 
      src="https://static.wixstatic.com/media/eb9535_9d1043c625be4e6882a9bc0ad92f3463~mv2.png/v1/crop/x_0,y_598,w_1500,h_338/fill/w_1200,h_270,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/MTM%20Thin%20Pink.png" 
      alt="Logo" 
      class="login-logo" 
    />
    <h2>Welcome, explorer!</h2>
    <p class="login-subtitle">This map is password protected</p>
    <form id="login-form">
      <input type="password" id="password" placeholder="Enter password" />
      <button type="submit" id="login-btn">Enter</button>
    </form>
    <p id="error">Incorrect password</p>
  </div>
</div>
<div id="map-container">
<div id="map"></div>
<div id="search-container">
  <input type="text" id="search" placeholder="Find a Sightseekr recommendation in Krakow..." />
  <div id="suggestions"></div>
</div>
<div id="layer-toggle">
  <h3>Sightseekr Recommended...</h3>
  <label><input type="checkbox" id="toggle-attractions" checked> <span class="icon icon-attraction"></span> Sightseeing</label><br>
  <label><input type="checkbox" id="toggle-restaurants" checked> <span class="icon icon-restaurant"></span> Restaurants</label><br>
  <label><input type="checkbox" id="toggle-bars" checked> <span class="icon icon-bar"></span> Bars</label><br>
  <label><input type="checkbox" id="toggle-cafes" checked> <span class="icon icon-cafe"></span> Cafes & Quick Bites</label>
</div></div>

<script>
  window.addEventListener('DOMContentLoaded', () => {
  if (localStorage.getItem('authenticated') === 'true') {
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('map-container').style.display = 'block';
    initializeMap();
  }
});
     const CORRECT_PASSWORD = "krk25";
let map;

// Login handler
document.getElementById('login-form').addEventListener('submit', function(e) {
  e.preventDefault();
  const input = document.getElementById('password').value;
  
  if (input === CORRECT_PASSWORD) {
    localStorage.setItem('authenticated', 'true');
    document.getElementById('login-page').style.display = 'none';
    document.getElementById('map-container').style.display = 'block';
    initializeMap();
  } else {
    document.getElementById('error').style.display = 'block';
  }
});
    function initializeMap() {
  mapboxgl.accessToken = 'pk.eyJ1Ijoic2lnaHRzZWVrciIsImEiOiJjbWgxdmNsZ2owc3h2MDhxcGdiZno4c3ptIn0.ODNk5NVKUxNh0b9QoL5tqQ';

    map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/sightseekr/cmja2st1i004k01qp0afrewy1',
    center: [19.934100, 50.053621],
    zoom: 12.84
  });

  map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');
  map.addControl(new mapboxgl.GeolocateControl({
    positionOptions: { enableHighAccuracy: true },
    trackUserLocation: true,
    showUserHeading: true
}), 'bottom-right');

const savedPoints = [
  {
    name: "Little Market Square (Ma≈Çy Rynek)",
    tags: ["square", "market", "old town", "attractions"],
    coordinates: [19.93999, 50.06099],
    description: "A small market square within Krakow's Old Town with seasonal stalls and attractions."
  },
  {
    name: "Main Square (Rynek G≈Ç√≥wny)",
    tags: ["square", "old town", "landmark", "food", "bars", "street food"],
    coordinates: [19.93675, 50.06189],
    description: "The main square in Krakow's old town, home to a daily market, halls and the Church of Virgin Mary. This entire square is home to lots of street food stalls, and lined with bars, cafes and restaurants. The atmosphere here is amazing, and it‚Äôs somewhere you‚Äôll find regular street performances and busking."
  },
  {
    name: "St. Mary's Basilica",
    tags: ["church", "basilica", "religious", "landmark"],
    coordinates: [19.93939, 50.06164],
    description: "The Church of the Virgin Mary in Krakow's city centre. It's free to go in and look around too - don't miss it! You do have to pay 18z≈Ç if you want to see the famous altar, and 20z≈Ç to go up the Bugle Tower (which is only open from May to October)."
  },
  {
    name: "Town Hall Tower",
    tags: ["tower", "landmark", "architecture"],
    coordinates: [19.93647, 50.06152],
    description: "The beautiful tower in Rynek G≈Ç√≥wny, an absolute must-see landmark in the centre of the city."
  },
  {
    name: "Rynek Underground Museum",
    tags: ["museum", "history", "underground"],
    coordinates: [19.93777, 50.06193],
    description: "A museum set below the indoor market in Rynek G≈Ç√≥wny, exploring the history of Krakow and showing excavated architechture."
  },
  {
    name: "Stare Miasto (Old Town)",
    tags: ["neighbourhood", "historic", "architecture", "cafes"],
    coordinates: [19.93771, 50.06056],
    description: "The old town of Krakow is a large area of historical, cultural and architectural sights to see! Plus, it‚Äôs filled with lovely cafes, bars and restaurants. This is where we‚Äôd suggest you spend most of your time on your trip, exploring and wandering through the streets."
  },
  {
    name: "Planty Park",
    tags: ["park", "nature", "walking"],
    coordinates: [19.94143, 50.05992],
    description: "This park encircles the whole of Krakow's old town area, and is a peaceful place to walk, rest or pass through to other parts of the city. It's home to a few cafes, fountains and sculptures too!"
  },
  {
    name: "Wawel Castle",
    tags: ["castle", "landmark", "museum", "history"],
    coordinates: [19.93542, 50.05411],
    description: "An absolute must-see, this castle is a complex made up of several stunning, and very important buildings, including the royal castle and state rooms, cathedral, and lots of smaller structures housing museums and exhibitions. It's free to enter the grounds, but to explore all the buildings and rooms you will have to pay for an entry ticket or a guided tour."
  },
  {
    name: "Plac Wolnica",
    tags: ["square", "jewish quarter", "cafes", "bars"],
    coordinates: [19.94451, 50.04908],
    description: "A square in the Jewish Quarter of Krakow with open space, benches to sit and people-watch, a beautiful town hall and lots of cafes and bars."
  },
  {
    name: "Corpus Christi Basilica",
    tags: ["basilica", "church", "religious"],
    coordinates: [19.94493, 50.04976],
    description: "A typical basilica set in a gorgeous courtyard with open, green space. And completely free to enter!"
  },
  {
    name: "Father Bernatek‚Äôs Bridge",
    tags: ["bridge", "river", "sculptures", "landmark"],
    coordinates: [19.94756, 50.04649],
    description: "A major bridge over the Vistula River, but with a little extra something. On the bridge, there are several sculptures of gymnasts and acrobats in \"gravity-defying\" poses! It's also a popular site for love locks."
  },
  {
    name: "Kazimierz Neighbourhood",
    tags: ["neighbourhood", "jewish quarter", "culture"],
    coordinates: [19.94471, 50.04855],
    description: "Krakow's historic Jewish Quarter, now packed with museums, galleries, and independent shops, cafes and restaurants."
  },
  {
    name: "St. Bernardine Church",
    tags: ["church", "religious"],
    coordinates: [19.93827, 50.05346],
    description: "A stunning Catholic church which is just a few steps away from Wawel Castle. Free to enter!"
  },
  {
    name: "Zakrz√≥wek Park",
    tags: ["park", "nature", "swimming"],
    coordinates: [19.91207, 50.03586],
    description: "An escape from the bustle of the city, this park is peaceful and a perfect swimming spot in Summer!"
  },
  {
    name: "Viewpoint for Wawel Castle",
    tags: ["viewpoint", "scenic", "views"],
    coordinates: [19.91402, 50.03998],
    description: "A stunning viewpoint near Zakrzowek where you can see panoramic city views, including Wawel Castle."
  },
  {
    name: "Swimming Pools Zakrz√≥wek",
    tags: ["swimming", "outdoors", "summer"],
    coordinates: null,
    description: "The perfect spot to cool down in Summer in Krakow (or take an icy dip in Winter if that's your thing)!"
  },
  {
    name: "Krakow Botanical Garden",
    tags: ["garden", "nature", "university"],
    coordinates: [19.95827, 50.06084],
    description: "This small botanical garden is a part of the Jagiellonian University and home to a unique variety of plants and flowers, as well as a small pond and a fountain. It's a great place to explore and have some peace and quiet away from the bustling old town."
  },
  {
    name: "Grodzka Street",
    tags: ["street", "old town", "shopping"],
    coordinates: [19.9381, 50.05767],
    description: "The main street running all the way through the Old Town, packed with attractions, statues, fountains, bars, shops and cafes. If you're ever bored in Krakow (which isn't easy to achieve), head here!"
  },
  {
    name: "Galeria Krakowska Shopping Centre",
    tags: ["shopping", "mall", "train station"],
    coordinates: [19.94612, 50.06626],
    description: "The main, central shopping centre in the city, which is conveniently attached to the main train station! You'll find a huge selection of shops here from designer to budget brands."
  },
  {
    name: "City Square Jana Nowaka-Jeziora≈Ñskiego",
    tags: ["square", "events", "markets", "street food"],
    coordinates: [19.94642, 50.0655],
    description: "Home to regular events and markets as well as being close to the main train station and shopping centre, this city square is always full of energy and life. A great place to grab some street food like zapeikanka!"
  },
  {
    name: "WOMAI Museum and Interactive Experiences",
    tags: ["museum", "interactive", "experience"],
    coordinates: [19.94475, 50.06948],
    description: "We visited for the \"Into the darkness\" experience at Womai. In a nutshell - you experience what it is like to be completely blind for an hour, and take part in a series of experiences to use your other senses, all accompanied by blind guide who supports you, and tells you about their experiences. It's fun, informative, and something so extraordinary that it's absolutely not worth missing."
  },
  {
    name: "Sukiennice Cloth Hall",
    tags: ["market", "historic", "landmark"],
    coordinates: [19.93733, 50.06159],
    description: "Considered the world's oldest market, this was built in the 13th century! Explore today for souvenirs and even an underground museum."
  },
  {
    name: "Tempel Synagogue",
    tags: ["synagogue", "religious", "jewish quarter"],
    coordinates: [19.94439, 50.0529],
    description: "A beautiful synagogue in the Jewish Quarter of Krakow, stunning from the exterior and interior too. It's 10PLN to enter, which is one of the cheaper entrance fees compared to other synagogues in the area."
  },

  // FOOD & DRINK

  {
    name: "ZakƒÖtek Cafe & Wine bar",
    tags: ["cafe", "wine bar", "old town"],
    coordinates: [19.93786, 50.06009],
    description: "By day, this is a cosy coffee shop in Krakow's old town. But as you head into the afternoon and evening, you can enjoy a glass of wine from their huge local and international selection, in the same comfortable setting."
  },
  {
    name: "Klub Re",
    tags: ["bar", "live music", "vodka"],
    coordinates: [19.94123, 50.06104],
    description: "A bar with a vast outdoor garden space, offering regular live music and events. They also offer vodka tasting boards - a must-try while you‚Äôre in Poland!"
  },
  {
    name: "W√≥dka Caf√© Bar",
    tags: ["bar", "vodka", "tasting"],
    coordinates: [19.9417, 50.06126],
    description: "A bar specialising in Vodka, offering an absolutely massive selection of flavours from chocolate, to wild rose, to caramel, to elderberry and pear! This bar is popular with tourists for their vodka tasting experiences."
  },
  {
    name: "Wawel Shop & Cafe",
    tags: ["cafe", "castle", "coffee"],
    coordinates: [19.93443, 50.05327],
    description: "Sit outside by the ivy-covered buildings, or warm up inside with a hot drink. This cafe is the perfect stop-off for a refreshment during your visit to Wawel Castle, or even if you're just passing through the area."
  },
  {
    name: "Prosta Pasta Fresco",
    tags: ["restaurant", "italian", "vegetarian"],
    coordinates: [19.94381, 50.04919],
    description: "A brilliant vegetarian restaurant offering Italian cuisine, from classics to new, modern dishes."
  },
  {
    name: "Curry up restaurant",
    tags: ["restaurant", "indian", "casual dining"],
    coordinates: [19.94302, 50.04903],
    description: "With indoor and outdoor seating, this restaurant offers quick service, reasonable prices and Polish-style Indian cuisine. The onion bhajis are to die for!"
  },
  {
    name: "PastaBar",
    tags: ["restaurant", "italian", "pasta"],
    coordinates: [19.93805, 50.06388],
    description: "A brilliant Italian restaurant right in the heart of Krakow's old town with a great range of tasty pasta dishes."
  },
  {
    name: "Dzikie Wino Wine Bar",
    tags: ["wine bar", "hidden gem", "old town"],
    coordinates: [19.93509, 50.06169],
    description: "Tucked away just off the main square, this wine bar is an absolute hidden gem. The atmosphere is laid-back, but still close enough to the very centre of the city that you can watch the world go by. You can enjoy wines from all over the world, as well as local favourites, and even non-alcoholic options!"
  },
  {
    name: "Cafe Zakrz√≥wek",
    tags: ["cafe", "snacks", "park"],
    coordinates: [19.91309, 50.035],
    description: "A refreshment spot near Zakrz√≥wek.park offering coffees, snacks and soft drinks."
  },
  {
    name: "≈ªar√≥wka Cafe",
    tags: ["cafe", "coffee", "local food"],
    coordinates: [19.94006, 50.06331],
    description: "This beautiful cafe is a bit of a hidden gem, just tucked away from one of the main streets. It has a comfortable outside area, friendly staff - and one of the best iced coffees we tried in Poland! Plus, they sell traditional Polish bagels (Obwarzanek krakowski) which originate from Krakow, an absolute must-try when you're in the city."
  },
  {
    name: "Zapiecek",
    tags: ["fast food", "sandwiches", "budget"],
    coordinates: [19.94006, 50.06333],
    description: "Very affordable and incredible quality, freshly made sandwiches, salads and snacks!"
  },
  {
    name: "Lody Rinella",
    tags: ["gelato", "dessert", "ice cream"],
    coordinates: [19.93966, 50.06286],
    description: "An amazing gelato stop just seconds away from the main square. They are consistently well-rated, we absolutely loved the dark chocolate flavour!"
  },
  {
    name: "Mayaza Falafel",
    tags: ["cafe", "vegan", "vegetarian"],
    coordinates: [19.95806, 50.05791],
    description: "A cafe stop with a pretty outdoor seating area with lots of vegan and vegetarian options."
  },
  {
    name: "Moo Moo Steak & Burger Club",
    tags: ["restaurant", "steak", "burgers"],
    coordinates: [19.9426, 50.0622],
    description: "A popular restaurant with tourists and locals alike - and for good reason. Their steaks and burgers are fresh, home-cooked and delicious!"
  },
  {
    name: "≈ªabka Convenience Store",
    tags: ["convenience store", "local", "fast food"],
    coordinates: [19.93772, 50.06263],
    description: "You can't go to Poland without visiting a ≈ªabka! They're so well known that it's almost a tourist activity to visit one. They sell a little bit of everything including fast food (locals rave about the hot dogs regularly as an affordable comfort / convenience food option)."
  },
  {
    name: "Kakao Cafe",
    tags: ["cafe", "chocolate", "dessert"],
    coordinates: [19.94199, 50.06111],
    description: "A chocolate cafe with a bit of a twist. Cosy, comfy, but offering a traditional cacao drink rather than the more popular milky, creamy and sugary hot chocolate you get in most cafes. With lots of different flavours, and snacks available too, you'll definitely find something you love."
  },
  {
    name: "Judah Food Market",
    tags: ["food market", "street food", "independent"],
    coordinates: [19.94798, 50.05028],
    description: "Whether you're looking for typical Polish street food like Zapiekanka or something international such as wood-fired pizza or belgian fries, you'll find it at this small, independent food market."
  },
  {
    name: "Groble SkyBar",
    tags: ["rooftop bar", "views", "cocktails"],
    coordinates: [19.9328, 50.05522],
    description: "A rooftop bar with a view of the Vistula River, Wawel castle and the city scenery around them. With cocktails, a good bar selection, and snacks on offer, there's no better place to relax with a view of the city."
  },
  {
    name: "Forum Commercial Centre",
    tags: ["food court", "riverside", "nightlife"],
    coordinates: [19.936, 50.04465],
    description: "A commercial centre with a food court and amusements, and a pretty riverside view. A great place to spend an evening."
  },
  {
    name: "Go≈õcinna Chata Restaurant",
    tags: ["restaurant", "polish food", "traditional"],
    coordinates: [19.93748, 50.0637],
    description: "A Polish traditional restaurant offering lots of authentic dishes such as potato pancakes, soups and, of course, pierogi."
  },
  {
    name: "Hamsa",
    tags: ["restaurant", "middle eastern", "sharing plates"],
    coordinates: [19.94762, 50.05318],
    description: "A gorgeous Middle-Eastern restaurant offering small plates, sharing platters and mains, as well as a great drinks selection. Some of the best food we've ever had in Poland - a must-try!"
  },
  {
    name: "Trzcina cocktail bar",
    tags: ["cocktail bar", "drinks", "relaxed"],
    coordinates: [19.94409, 50.05147],
    description: "A gorgeous little cocktail bar with a relaxed atmosphere and a wide range of very high-quality drinks."
  }
];

const directionsLinks = {
  "Little Market Square (Ma≈Çy Rynek)": "https://maps.google.com/?q=Ma%C5%82y+Rynek,+Krak%C3%B3w,+Polska&ftid=0x47165b11898a201b:0x1a93e8ef65f3084c",
  "Main Square (Rynek G≈Ç√≥wny)": "https://maps.google.com/?cid=14107513768635600179",
  "St. Mary's Basilica": "https://maps.google.com/?cid=15940242599518715698",
  "Town Hall Tower": "https://maps.google.com/?cid=774207539409295598",
  "Rynek Underground Museum": "https://maps.google.com/?cid=11901569443430393763",
  "Stare Miasto (Old Town)": "google.com/maps?cid=5661472973199083066",
  "Planty Park": "https://maps.google.com/?cid=4148526053262504031",
  "Wawel Castle": "https://maps.google.com/?cid=12446225081720350104",
  "Plac Wolnica": "https://maps.google.com/?q=plac+Wolnica,+Krak%C3%B3w,+Polska&ftid=0x47165b69e6805ff7:0x6a847173d6cf1890",
  "Corpus Christi Basilica": "https://maps.google.com/?cid=1095266165835926138",
  "Father Bernatek‚Äôs Bridge": "https://www.google.com/maps?cid=7621871869816386153",
  "Kazimierz Neighbourhood": "https://maps.google.com/?cid=7090687386334420695",
  "St. Bernardine Church": "https://maps.google.com/?cid=6037251679319157881",
  "Zakrz√≥wek Park": "https://maps.google.com/?cid=15360576881862240466",
  "Viewpoint for Wawel Castle": "https://maps.google.com/?cid=3707088558396806542",
  "Krakow Botanical Garden": "https://maps.google.com/?cid=9249298449956183016",
  "Grodzka Street": "https://maps.google.com/?cid=7092503032384592868",
  "Galeria Krakowska Shopping Centrƒô": "https://maps.google.com/?cid=6640739639189620730",
  "City Square Jana Nowaka-Jeziora≈Ñskiego": "https://maps.google.com/?cid=2104012072487173285",
  "WOMAI Museum and Interactive Experiences": "https://maps.google.com/?cid=5792009362116403025",
  "Sukiennice Cloth Hall": "https://maps.google.com/?cid=14996824190985924979",
  "Tempel Synagogue": "https://maps.google.com/?cid=13128246550848837711",
  "Swimming Pools Zakrz√≥wek": "https://www.google.com/maps?cid=12594159944981089385",
  "ZakƒÖtek Cafe & Wine bar": "https://maps.google.com/?cid=9935703554477808388",
  "Klub Re": "https://maps.google.com/?cid=6810107824580290420",
  "W√≥dka Caf√© Bar": "https://www.google.com/maps/place/W%C3%B3dka+Caf%C3%A9+Bar/@50.0609296,19.9415677,115m/data=!3m1!1e3!4m14!1m7!3m6!1s0x47165b13d4acfa3f:0x5e825cfc26376774!2sKlub+Re!8m2!3d50.0610439!4d19.9412308!16s%2Fg%2F1vs1qm0r!3m5!1s0x47165b1183c65153:0x78a6b109569f5558!8m2!3d50.0612691!4d19.9417058!16s%2Fg%2F1v76ycv0?entry=ttu&g_ep=EgoyMDI1MTIwMi4wIKXMDSoASAFQAw%3D%3D",
  "Wawel Shop & Cafe": "https://maps.google.com/?cid=3295182820062279998",
  "Prosta Pasta Fresco": "https://maps.google.com/?cid=1958002788720781344",
  "Curry up restaurant": "https://maps.google.com/?cid=2190172327080365121",
  "PastaBar": "https://maps.google.com/?cid=10143529471153908721",
  "Dzikie Wino Wine Bar": "https://maps.google.com/?cid=17773642346352655248",
  "Cafe Zakrz√≥wek": "https://maps.google.com/?cid=9306403729035276042",
  "≈ªar√≥wka Cafe": "https://maps.google.com/?cid=11612337601541951071",
  "Zapiecek": "https://maps.google.com/?cid=18095717398906458740",
  "Lody Rinella": "https://maps.google.com/?cid=16422041107423465372",
  "Mayaza Falafel": "https://maps.google.com/?cid=17560397460777838922",
  "Moo Moo Steak & Burger Club": "https://maps.google.com/?cid=16811675641873948154",
  "≈ªabka Convenience Store": "https://maps.google.com/?cid=16018258915037849214",
  "Kakao Cafe": "https://maps.google.com/?cid=2207189392954645312",
  "Judah Food Market": "https://maps.google.com/?cid=5923673437934957108",
  "Groble SkyBar": "https://maps.google.com/?cid=3588702880176726085",
  "Forum Commercial Centre": "https://maps.google.com/?cid=16210088253009670125",
  "Go≈õcinna Chata Restaurant": "https://maps.google.com/?cid=16562560695386527136",
  "Hamsa": "https://maps.google.com/?cid=1317891001987072687",
  "Trzcina cocktail bar": "https://maps.google.com/?cid=15433220553319598897"
};

  const fuse = new Fuse(savedPoints, {
    keys: ['name', 'tags'],
    threshold: 0.4,
    ignoreLocation: true,
    includeScore: true
  });

  const searchInput = document.getElementById('search');
  const suggestionsDiv = document.getElementById('suggestions');
  let currentPopup = null;
  let allFeatures = [];
  let popupOpenedByClick = false
  let popupHovering = false;

  function isMobile() {
    return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  }

function createPopup(feature, lngLat, clicked = false) {
  // remove any existing popup
  if (currentPopup) {
    currentPopup.remove();
    currentPopup = null;
  }

  // set whether this popup is "locked" by a click
  popupOpenedByClick = clicked;
  // reset hover flag
  popupHovering = false;

  const name = feature.properties?.name || feature.properties?.Name || feature.properties?.title || "No title";
  const description = feature.properties?.description || feature.properties?.Description || "No description";
  const directions = directionsLinks[name] || `https://www.google.com/maps/search/${encodeURIComponent(name)}`;

  currentPopup = new mapboxgl.Popup({ closeButton: false })
    .setLngLat(lngLat)
    .setHTML(`
      <div class="custom-popup">
        <strong>${name}</strong>
        <p>${description}</p>
        <a href="${directions}" class="directions-btn" target="_blank">
          <span>üìç</span> <span>Directions</span>
        </a>
      </div>
    `)
    .addTo(map);

  // Popup DOM hover handlers ‚Äî keep popup open while mouse is over it
  const popupEl = document.querySelector(".mapboxgl-popup");
  if (popupEl) {
    popupEl.addEventListener("mouseenter", () => {
      popupHovering = true;
    });
    popupEl.addEventListener("mouseleave", () => {
      popupHovering = false;
      // close only if not locked by click
      if (!popupOpenedByClick && currentPopup) {
        currentPopup.remove();
        currentPopup = null;
      }
    });
  }
}

function searchAndZoomToFeature(name) {
  const lowerName = name.toLowerCase();

  // 1Ô∏è‚É£ First: check all loaded features (includes description)
  for (let feature of allFeatures) {
    const featureName =
      feature.properties?.name ||
      feature.properties?.Name ||
      feature.properties?.title;

    if (featureName && featureName.toLowerCase().includes(lowerName)) {
      const coords = feature.geometry.coordinates;
      map.flyTo({ center: coords, zoom: 17 });

      setTimeout(() => createPopup(feature, coords, true), 300);
      return;
    }
  }

  // 2Ô∏è‚É£ If not found, check currently rendered features (backup)
  const rendered = map.queryRenderedFeatures();
  for (let feature of rendered) {
    const featureName =
      feature.properties?.name ||
      feature.properties?.Name ||
      feature.properties?.title;

    if (featureName && featureName.toLowerCase().includes(lowerName)) {
      const coords = feature.geometry.coordinates;
      map.flyTo({ center: coords, zoom: 17 });

      setTimeout(() => createPopup(feature, coords, true), 300);
      return;
    }
  }

// 3Ô∏è‚É£ Use savedPoints (guaranteed list with coords)
const matchingPoint = savedPoints.find(p => p.name.toLowerCase().includes(lowerName));
if (matchingPoint) {
  if (matchingPoint.coordinates) {
    const directions = directionsLinks[matchingPoint.name] || `https://www.google.com/maps/search/${encodeURIComponent(matchingPoint.name)}`;
    map.flyTo({ center: matchingPoint.coordinates, zoom: 17 });
    setTimeout(() => {
      currentPopup = new mapboxgl.Popup({ closeButton: false })
        .setLngLat(matchingPoint.coordinates)
        .setHTML(`
          <div class="custom-popup">
            <strong>${matchingPoint.name}</strong>
            <p>${matchingPoint.description || ''}</p>
            <a href="${directions}" class="directions-btn" target="_blank">
              <span>üìç</span> <span>Directions</span>
            </a>
          </div>
        `)
        .addTo(map);
    }, 300);
  } else {
    alert('"' + matchingPoint.name + '": Coordinates not available.');
  }
  return;
}
}
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim();
    suggestionsDiv.innerHTML = '';
    if (!query) {
      savedPoints.forEach(item => {
        const div = document.createElement('div');
        div.className = 'suggestion';
        div.textContent = item.name;
        div.onclick = () => {
          searchInput.value = item.name;
          suggestionsDiv.innerHTML = '';
          searchAndZoomToFeature(item.name);
        };
        suggestionsDiv.appendChild(div);
      });
      return;
    }
    const results = fuse.search(query);
    if (results.length) {
      results.forEach(({ item }) => {
        const div = document.createElement('div');
        div.className = 'suggestion';
        div.textContent = item.name;
        div.onclick = () => {
          searchInput.value = item.name;
          suggestionsDiv.innerHTML = '';
          searchAndZoomToFeature(item.name);
        };
        suggestionsDiv.appendChild(div);
      });
    } else {
      const div = document.createElement('div');
      div.className = 'no-results';
      div.textContent = "Can't find what you're looking for? It must not be somewhere we've tried & tested for you yet! Why not try a Google Search instead?";
      suggestionsDiv.appendChild(div);
    }
  });

  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const query = searchInput.value.trim();
      const result = fuse.search(query)[0];
      if (result) {
        searchAndZoomToFeature(result.item.name);
        suggestionsDiv.innerHTML = '';
      }
    }
  });

  searchInput.addEventListener('focus', () => searchInput.dispatchEvent(new Event('input')));

  document.addEventListener('click', function (event) {
    const isClickInside = searchInput.contains(event.target) || suggestionsDiv.contains(event.target);
    if (!isClickInside) {
      suggestionsDiv.innerHTML = '';
    }
  });

  map.on('load', () => {
    const layers = ['sightseeing', 'restaurants', 'bars', 'cafes'];
    const layerCheckboxes = {
  sightseeing: document.getElementById('toggle-attractions'),
  restaurants: document.getElementById('toggle-restaurants'),
  bars: document.getElementById('toggle-bars'),
  cafes: document.getElementById('toggle-cafes')
};
    const layerToSourceLayer = {
      'sightseeing': 'krakowsights-4jzi7f',
      'restaurants': 'krakowrest-74f7b0',
      'bars': 'krakowbar-3bbux6',
      'cafes': 'krakowcafe-audft0'
    };
    const sourceId = 'composite';

    function loadAllFeatures() {
      layers.forEach(layer => {
        const sourceLayer = layerToSourceLayer[layer];
        try {
          const sourceFeatures = map.querySourceFeatures(sourceId, {
            sourceLayer: sourceLayer
          });
          sourceFeatures.forEach(feature => {
            const isDuplicate = allFeatures.some(existing => 
              existing.properties && feature.properties &&
              existing.properties.name === feature.properties.name
            );
            if (!isDuplicate && feature.properties && feature.properties.name) {
              allFeatures.push(feature);
            }
          });
        } catch (error) {
          const renderedFeatures = map.queryRenderedFeatures({ layers: [layer] });
          renderedFeatures.forEach(feature => {
            const isDuplicate = allFeatures.some(existing => 
              existing.properties && feature.properties &&
              existing.properties.name === feature.properties.name
            );
            if (!isDuplicate && feature.properties && feature.properties.name) {
              allFeatures.push(feature);
            }
          });
     }
      });
    }

    map.on('data', (e) => {
      if (e.dataType === 'source' && e.sourceId === sourceId) {
        allFeatures = [];
        loadAllFeatures();
      }
    });

    map.once('idle', () => {
      if (allFeatures.length === 0) {
        loadAllFeatures();
      }
    });
Object.entries(layerCheckboxes).forEach(([layerId, checkbox]) => {
  if (!checkbox) return;

  checkbox.addEventListener('change', (e) => {
    const visibility = e.target.checked ? 'visible' : 'none';

    if (map.getLayer(layerId)) {
      map.setLayoutProperty(layerId, 'visibility', visibility);
    } else {
      console.warn(`Layer not found: ${layerId}`);
    }
  });
});
if (!isMobile()) {
  layers.forEach(layer => {
    // Hover: show popup (not locked)
    map.on('mouseenter', layer, e => {
      map.getCanvas().style.cursor = 'pointer';
      createPopup(e.features[0], e.lngLat, false);
    });

    // When leaving the marker: wait a short tick and only close if
    // not hovering the popup and not clicked (locked)
    map.on('mouseleave', layer, () => {
      map.getCanvas().style.cursor = '';
      setTimeout(() => {
        if (!popupOpenedByClick && !popupHovering && currentPopup) {
          currentPopup.remove();
          currentPopup = null;
        }
      }, 40); // tiny delay to allow mouse to enter popup
    });

    // Click on marker: open popup and lock it (until clicking map background)
    map.on('click', layer, e => {
      if (currentPopup) currentPopup.remove();
      createPopup(e.features[0], e.lngLat, true);
    });
  });
}else {
    // Mobile: only click to open popup (no hover)
    layers.forEach(layer => {
        map.on('click', layer, e => {
        if (currentPopup) currentPopup.remove();
        createPopup(e.features[0], e.lngLat, true);
        });
    });
}
    // Click on map background: close any open popup
    map.on('click', (e) => {
      const features = map.queryRenderedFeatures(e.point, { layers: layers });
      if (features.length === 0 && currentPopup) {
        currentPopup.remove();
        currentPopup = null;
        popupOpenedByClick = false;
      }
    });
  });
}
</script>
</body>
</html> 
